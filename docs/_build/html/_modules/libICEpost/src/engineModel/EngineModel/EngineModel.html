

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>libICEpost.src.engineModel.EngineModel.EngineModel &mdash; libICEpost  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=fd3f3429" />

  
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            libICEpost
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../example.html">Example usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">libICEpost</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">libICEpost.src.engineModel.EngineModel.EngineModel</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for libICEpost.src.engineModel.EngineModel.EngineModel</h1><div class="highlight"><pre>
<span></span><span class="c1">#####################################################################</span>
<span class="c1">#                                 DOC                               #</span>
<span class="c1">#####################################################################</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">@author: F. Ramognino       &lt;federico.ramognino@polimi.it&gt;</span>
<span class="sd">Last update:        12/06/2023</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#####################################################################</span>
<span class="c1">#                               IMPORT                              #</span>
<span class="c1">#####################################################################</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">FunctionType</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">libICEpost.src.base.BaseClass</span> <span class="kn">import</span> <span class="n">BaseClass</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">libICEpost.src.base.dataStructures.EngineData.EngineData</span> <span class="kn">import</span> <span class="n">EngineData</span>
<span class="kn">from</span> <span class="nn">libICEpost.src.base.Filter.Filter</span> <span class="kn">import</span> <span class="n">Filter</span>

<span class="kn">from</span> <span class="nn">libICEpost.src.base.dataStructures.Dictionary</span> <span class="kn">import</span> <span class="n">Dictionary</span>

<span class="kn">from</span> <span class="nn">..EngineTime.EngineTime</span> <span class="kn">import</span> <span class="n">EngineTime</span>
<span class="kn">from</span> <span class="nn">..EngineGeometry.EngineGeometry</span> <span class="kn">import</span> <span class="n">EngineGeometry</span>

<span class="kn">from</span> <span class="nn">libICEpost.src.thermophysicalModels.thermoModels.thermoMixture.ThermoMixture</span> <span class="kn">import</span> <span class="n">ThermoMixture</span>
<span class="kn">from</span> <span class="nn">libICEpost.src.thermophysicalModels.thermoModels.ThermoModel</span> <span class="kn">import</span> <span class="n">ThermoModel</span>

<span class="kn">from</span> <span class="nn">libICEpost.src.thermophysicalModels.thermoModels.CombustionModel.CombustionModel</span> <span class="kn">import</span> <span class="n">CombustionModel</span>
<span class="kn">from</span> <span class="nn">libICEpost.src.thermophysicalModels.thermoModels.EgrModel.EgrModel</span> <span class="kn">import</span> <span class="n">EgrModel</span>
<span class="kn">from</span> <span class="nn">libICEpost.src.engineModel.HeatTransferModel.HeatTransferModel</span> <span class="kn">import</span> <span class="n">HeatTransferModel</span>

<span class="kn">from</span> <span class="nn">libICEpost.src.thermophysicalModels.thermoModels.CombustionModel.NoCombustion</span> <span class="kn">import</span> <span class="n">NoCombustion</span>
<span class="kn">from</span> <span class="nn">libICEpost.src.engineModel.HeatTransferModel.Woschni</span> <span class="kn">import</span> <span class="n">Woschni</span>

<span class="kn">from</span> <span class="nn">libICEpost.Database.chemistry.specie.Mixtures</span> <span class="kn">import</span> <span class="n">Mixtures</span><span class="p">,</span> <span class="n">Mixture</span>

<span class="c1">#############################################################################</span>
<span class="c1">#                               MAIN CLASSES                                #</span>
<span class="c1">#############################################################################</span>
<span class="c1"># TODO:</span>
<span class="c1">#   Handle direct injection (injectionModel?)</span>
<span class="c1">#   Handle interaction with other zones (creviceModel? prechamberModel?)</span>

<span class="c1"># NOTE: to handle diesel combustion, need to compute the phi from the injected mass </span>
<span class="c1"># (probably the main parameter for the combustion model)</span>

<span class="c1"># NOTE: This model handles a single-zone model of the cylinder. Sub-classes may be </span>
<span class="c1"># defined to introduce additional zones, like in case of pre-chamber engines, crevice </span>
<span class="c1"># modeling, or maybe gas-exchange analysis (ducts)</span>

<div class="viewcode-block" id="EngineModel">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel">[docs]</a>
<span class="k">class</span> <span class="nc">EngineModel</span><span class="p">(</span><span class="n">BaseClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for modeling of an engine and processing experimental/numerical data</span>
<span class="sd">    </span>
<span class="sd">    NOTE:</span>
<span class="sd">    For naming of variables:</span>
<span class="sd">        -&gt; By default they refer to the &quot;cylinder&quot; zone</span>
<span class="sd">        -&gt; Variables referred to a specific zone are allocated as &quot;&lt;variableName&gt;_&lt;zoneName&gt;&quot;</span>
<span class="sd">    </span>
<span class="sd">    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="sd">    TODO: documentation and user info</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Attibutes:</span>
    <span class="n">_cylinder</span><span class="p">:</span><span class="n">ThermoModel</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cylinder thermodynamic region&quot;&quot;&quot;</span>
    
    <span class="n">Types</span><span class="p">:</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">:</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> \
        <span class="p">{</span>
            <span class="s2">&quot;EngineGeometry&quot;</span><span class="p">:</span>           <span class="n">EngineGeometry</span><span class="p">,</span>
            <span class="s2">&quot;EngineTime&quot;</span><span class="p">:</span>               <span class="n">EngineTime</span><span class="p">,</span>
            <span class="s2">&quot;EgrModel&quot;</span><span class="p">:</span>                 <span class="n">EgrModel</span><span class="p">,</span>
            <span class="s2">&quot;CombustionModel&quot;</span><span class="p">:</span>          <span class="n">CombustionModel</span><span class="p">,</span>
            <span class="s2">&quot;HeatTransferModel&quot;</span><span class="p">:</span>        <span class="n">HeatTransferModel</span><span class="p">,</span>
        <span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Types for each main model&quot;&quot;&quot;</span>
    
    <span class="n">Submodels</span><span class="p">:</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">:</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> \
        <span class="p">{</span>
            <span class="s2">&quot;EgrModel&quot;</span><span class="p">:</span>             <span class="n">EgrModel</span><span class="p">(),</span> <span class="c1"># 0% EGR</span>
            <span class="s2">&quot;CombustionModel&quot;</span><span class="p">:</span>      <span class="n">NoCombustion</span><span class="p">(</span><span class="n">reactants</span><span class="o">=</span><span class="n">Mixture</span><span class="o">.</span><span class="n">empty</span><span class="p">()),</span> <span class="c1">#Inhert (motoring)</span>
            <span class="s2">&quot;HeatTransferModel&quot;</span><span class="p">:</span>    <span class="n">Woschni</span><span class="p">(),</span>  <span class="c1"># Woschni model with default coeffs.</span>
        <span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The available sub-models and their default initializers&quot;&quot;&quot;</span>
    
    <span class="n">Zones</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> \
        <span class="p">[</span>
            <span class="s2">&quot;cylinder&quot;</span>
        <span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The zones avaliable in the model&quot;&quot;&quot;</span>
    
    <span class="n">thermophysicalProperties</span><span class="p">:</span><span class="n">Dictionary</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary with thermophysical properties for mixtures&quot;&quot;&quot;</span>
    
    <span class="n">combustionProperties</span><span class="p">:</span><span class="n">Dictionary</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary with properties for combustion modeling and chemical composition of mixtures&quot;&quot;&quot;</span>
    
    <span class="n">CombustionModel</span><span class="p">:</span><span class="n">CombustionModel</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The combustion model&quot;&quot;&quot;</span>
    
    <span class="n">EgrModel</span><span class="p">:</span><span class="n">EgrModel</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The EGR model&quot;&quot;&quot;</span>
    
    <span class="n">HeatTransferModel</span><span class="p">:</span><span class="n">HeatTransferModel</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The wall heat transfer model&quot;&quot;&quot;</span>
    
    <span class="n">_air</span><span class="p">:</span><span class="n">Mixture</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Air mixture&quot;&quot;&quot;</span>
    
    <span class="n">info</span><span class="p">:</span><span class="n">Dictionary</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;General information for pre-post processing&quot;&quot;&quot;</span>
    
    <span class="c1">#########################################################################</span>
    <span class="c1"># Properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">EngineData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The raw data</span>

<span class="sd">        Returns:</span>
<span class="sd">            EngineData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span>
    
    <span class="c1">#################################</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">EngineData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The processed/filtered data</span>

<span class="sd">        Returns:</span>
<span class="sd">            EngineData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
    
    <span class="c1">#########################################################################</span>
    <span class="c1"># Class methods</span>
<div class="viewcode-block" id="EngineModel.fromDictionary">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.fromDictionary">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromDictionary</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">:</span><span class="n">Dictionary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct from dictionary like:</span>
<span class="sd">        {</span>
<span class="sd">            EngineTime:         str</span>
<span class="sd">                Name of the EngineTime model to use</span>
<span class="sd">            &lt;EngineTime&gt;Dict:   dict</span>
<span class="sd">                Dictionary containing the data specific of the selected </span>
<span class="sd">                SngineTime model (e.g., if engineTime is &#39;SparkIgnitionTime&#39;,</span>
<span class="sd">                then this dictionary must be named &#39;SparkIgnitionTimeDict&#39;). </span>
<span class="sd">                See at the helper for function &#39;fromDictionary&#39; of the specific </span>
<span class="sd">                EngineTime model selected.</span>
<span class="sd">                </span>
<span class="sd">            EngineGeometry:         str</span>
<span class="sd">                Name of the EngineGeometry model to use</span>
<span class="sd">            &lt;EngineGeometry&gt;Dict:   dict</span>
<span class="sd">                Dictionary with data required from engineGeometry.</span>
<span class="sd">                See at the helper for function &#39;fromDictionary&#39; of the specific </span>
<span class="sd">                EngineGeometry model selected.</span>
<span class="sd">            </span>
<span class="sd">            thermoPhysicalProperties:   dict</span>
<span class="sd">                Dictionary with types and data for thermophysical modeling of mixtures</span>
<span class="sd">            {</span>
<span class="sd">                ThermoType: dict</span>
<span class="sd">                {</span>
<span class="sd">                    Thermo: str</span>
<span class="sd">                    EquationOfState:    str</span>
<span class="sd">                }</span>
<span class="sd">                &lt;Thermo&gt;Dict: dict</span>
<span class="sd">                &lt;EquationOfState&gt;Dict: dict</span>
<span class="sd">            }</span>
<span class="sd">            </span>
<span class="sd">            combustionProperties:   dict</span>
<span class="sd">                Dictionaries for data required for mixture preparation and combustion modeling.</span>
<span class="sd">            {</span>
<span class="sd">                injectionModels: dict</span>
<span class="sd">                {</span>
<span class="sd">                    TODO</span>
<span class="sd">                },</span>
<span class="sd">                </span>
<span class="sd">                air:    Mixture (default: database.chemistry.specie.Mixtures.dryAir)</span>
<span class="sd">                    The air mixture composition</span>
<span class="sd">                </span>
<span class="sd">                initialMixture: dict</span>
<span class="sd">                    Dictionary with data for initialization of the mixture </span>
<span class="sd">                    in the thermodynamic zones</span>
<span class="sd">                {</span>
<span class="sd">                    &lt;zoneName&gt;:</span>
<span class="sd">                    {</span>
<span class="sd">                        [depends on specific engine model]</span>
<span class="sd">                    }</span>
<span class="sd">                },</span>
<span class="sd">                </span>
<span class="sd">                CombustionModel:         str</span>
<span class="sd">                    Name of the CombustionModel to use</span>
<span class="sd">                &lt;CombustionModel&gt;Dict:   dict</span>
<span class="sd">                    Dictionary with data required from CombustionModel</span>
<span class="sd">                    See at the helper for function &#39;fromDictionary&#39; of the specific </span>
<span class="sd">                    CombustionModel model selected.</span>
<span class="sd">            }</span>
<span class="sd">            </span>
<span class="sd">            dataDict (dictionary): Dictionary with info for loading data, pre-processing and setting initial conditions.</span>
<span class="sd">            {</span>
<span class="sd">                TODO</span>
<span class="sd">            }</span>
<span class="sd">        }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">checkTypes</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">],</span> <span class="s2">&quot;dictionary&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">dictionary</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Constructing engine model from dictionary</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1">#Engine time:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Construct EngineTime&quot;</span><span class="p">)</span>
            <span class="n">etModel</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;EngineTime&quot;</span><span class="p">)</span>
            <span class="n">ET</span> <span class="o">=</span> <span class="n">EngineTime</span><span class="o">.</span><span class="n">selector</span><span class="p">(</span><span class="n">etModel</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">etModel</span> <span class="o">+</span> <span class="s2">&quot;Dict&quot;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ET</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1">#EngineGeometry:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Construct EngineGeometry&quot;</span><span class="p">)</span>
            <span class="n">egModel</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;EngineGeometry&quot;</span><span class="p">)</span>
            <span class="n">EG</span> <span class="o">=</span> <span class="n">EngineGeometry</span><span class="o">.</span><span class="n">selector</span><span class="p">(</span><span class="n">egModel</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">egModel</span> <span class="o">+</span> <span class="s2">&quot;Dict&quot;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">EG</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1">#combustionProperties</span>
            <span class="n">combustionProperties</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;combustionProperties&quot;</span><span class="p">)</span>
            
            <span class="c1">#thermophysical properties</span>
            <span class="n">thermophysicalProperties</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;thermophysicalProperties&quot;</span><span class="p">)</span>
            
            <span class="c1">#Data for pre-processing</span>
            <span class="n">dataDict</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;dataDict&quot;</span><span class="p">)</span>
            
            <span class="c1">#Submodels</span>
            <span class="n">subModels</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">smDict</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">lookupOrDefault</span><span class="p">(</span><span class="s2">&quot;submodels&quot;</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Submodels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sm</span> <span class="o">+</span> <span class="s2">&quot;Type&quot;</span> <span class="ow">in</span> <span class="n">smDict</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Constructing </span><span class="si">{</span><span class="n">sm</span><span class="si">}</span><span class="s2"> sub-model&quot;</span><span class="p">)</span>
                    <span class="n">smTypeName</span> <span class="o">=</span> <span class="n">smDict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">sm</span> <span class="o">+</span> <span class="s2">&quot;Type&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Type: </span><span class="si">{</span><span class="n">smTypeName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">subModels</span><span class="p">[</span><span class="n">sm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Types</span><span class="p">[</span><span class="n">sm</span><span class="p">]</span><span class="o">.</span><span class="n">selector</span><span class="p">(</span><span class="n">smTypeName</span><span class="p">,</span> <span class="n">smDict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">smTypeName</span> <span class="o">+</span> <span class="s2">&quot;Dict&quot;</span><span class="p">))</span>
            
            <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ET</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">EG</span><span class="p">,</span> <span class="n">thermophysicalProperties</span><span class="o">=</span><span class="n">thermophysicalProperties</span><span class="p">,</span> <span class="n">combustionProperties</span><span class="o">=</span><span class="n">combustionProperties</span><span class="p">,</span> <span class="n">dataDict</span><span class="o">=</span><span class="n">dataDict</span><span class="p">,</span> <span class="o">**</span><span class="n">subModels</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
            
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">fatalErrorInClass</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">fromDictionary</span><span class="p">,</span> <span class="s2">&quot;Failed contruction from dictionary&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span></div>

    
    <span class="c1">#########################################################################</span>
    <span class="c1">#Constructor:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">time</span><span class="p">:</span><span class="n">EngineTime</span><span class="p">,</span>
                 <span class="n">geometry</span><span class="p">:</span><span class="n">EngineGeometry</span><span class="p">,</span>
                 <span class="n">thermophysicalProperties</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="p">,</span>
                 <span class="n">combustionProperties</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="p">,</span>
                 <span class="n">dataDict</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">submodels</span><span class="p">,</span>
                 <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Base class for engine model, used for type-checking and loading the sub-models.</span>

<span class="sd">        Args:</span>
<span class="sd">            time (EngineTime): The engine time</span>
<span class="sd">            geometry (EngineGeometry): The engine geometry</span>
<span class="sd">            thermophysicalProperties (dict|Dictionary): Dictionary with thermophysical properties of mixtures</span>
<span class="sd">            combustionProperties (dict|Dictionary): Dictionary with combustion data and chemical composition</span>
<span class="sd">            dataDict (dict|Dictionary, optional): Dictionary for loading data. If not given, data are not loaded </span>
<span class="sd">                and thermodynamic regions not initialized. Defaults to None.</span>
<span class="sd">            **submodels (dict, optional): Optional sub-models to load. Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#Main models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Types</span><span class="p">[</span><span class="s2">&quot;EngineGeometry&quot;</span><span class="p">],</span> <span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Types</span><span class="p">[</span><span class="s2">&quot;EngineTime&quot;</span><span class="p">],</span> <span class="s2">&quot;engineTime&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
            
            <span class="c1">#Data structures</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="n">EngineData</span><span class="p">()</span>     <span class="c1">#Raw data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">EngineData</span><span class="p">()</span>    <span class="c1">#Filtered data</span>
            
            <span class="c1">#Submodels</span>
            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Submodels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">submodels</span><span class="p">:</span>
                    <span class="c1">#Get from input</span>
                    <span class="n">sm</span> <span class="o">=</span> <span class="n">submodels</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Types</span><span class="p">[</span><span class="n">model</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">submodels</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#Take default</span>
                    <span class="n">sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Submodels</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c1">#Set sub-model</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sm</span><span class="p">)</span>
            
            <span class="c1">#Thermos</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">thermophysicalProperties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;thermophysicalProperties&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thermophysicalProperties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">thermophysicalProperties</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="o">**</span><span class="n">thermophysicalProperties</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thermophysicalProperties</span> <span class="o">=</span> <span class="n">thermophysicalProperties</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="c1">#Combustion properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;combustionProperties&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">combustionProperties</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="o">**</span><span class="n">combustionProperties</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combustionProperties</span> <span class="o">=</span> <span class="n">combustionProperties</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="c1">#Contruct the thermodynamic models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_constructThemodynamicModels</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">)</span>
            
            <span class="c1">#TODO: construct injection models</span>
            
            <span class="c1">#Construct the Egr model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_constructEgrModel</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">)</span>
            
            <span class="c1">#Construct the combustion model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_constructCombustionModel</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">)</span>
            
            <span class="c1">#Misc parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;dataDict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;initialConditions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="c1">#Pre-processing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dataDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">preProcess</span><span class="p">(</span><span class="o">**</span><span class="n">dataDict</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatalErrorInClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed constructing instance of class </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    
    <span class="c1">#########################################################################</span>
    <span class="c1">#Construction methods:</span>
<div class="viewcode-block" id="EngineModel._constructThemodynamicModels">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._constructThemodynamicModels">[docs]</a>
    <span class="k">def</span> <span class="nf">_constructThemodynamicModels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">combustionProperties</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the thermodynamic models of the system, setting their initial </span>
<span class="sd">        mixture composition. Here setting everything to air, might be overwritten</span>
<span class="sd">        in sub-classes to handle specific initializations (SI engine will use </span>
<span class="sd">        the premixedFuel entry)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            combustionProperties (dict|Dictionary): the combustion properties</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            EngineModel: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;combustionProperties&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">):</span>
            <span class="n">combustionProperties</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="o">**</span><span class="n">combustionProperties</span><span class="p">)</span>
            
        <span class="c1">#Air composition</span>
        <span class="n">air</span> <span class="o">=</span> <span class="n">combustionProperties</span><span class="o">.</span><span class="n">lookupOrDefault</span><span class="p">(</span><span class="s2">&quot;air&quot;</span><span class="p">,</span> <span class="n">Mixtures</span><span class="o">.</span><span class="n">dryAir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_air</span> <span class="o">=</span> <span class="n">air</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="c1">#Here set everything to air, in sub-classes update</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">zone</span><span class="p">,</span> <span class="n">ThermoModel</span><span class="p">(</span><span class="n">ThermoMixture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_air</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">thermophysicalProperties</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel._constructEgrModel">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._constructEgrModel">[docs]</a>
    <span class="k">def</span> <span class="nf">_constructEgrModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">combustionProperties</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the EGR model and apply it to the cylinder region.</span>
<span class="sd">        Might be overwritten in child for applying EGR also to sub-regions of cylinder.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            combustionProperties (dict|Dictionary): the combustion properties</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            EngineModel: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Constructing EGR model&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;combustionProperties&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">):</span>
            <span class="n">combustionProperties</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="o">**</span><span class="n">combustionProperties</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s2">&quot;EgrModel&quot;</span> <span class="ow">in</span> <span class="n">combustionProperties</span><span class="p">:</span>
            <span class="c1">#Construct egr model from combustion properties</span>
            <span class="n">egrModelType</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="n">combustionProperties</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;EgrModel&quot;</span><span class="p">)</span>
            <span class="n">egrModelDict</span> <span class="o">=</span> <span class="n">combustionProperties</span><span class="o">.</span><span class="n">lookupOrDefault</span><span class="p">(</span><span class="n">egrModelType</span> <span class="o">+</span> <span class="s2">&quot;Dict&quot;</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">())</span>
            <span class="n">egrModelDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">reactants</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">mix</span><span class="p">)</span> <span class="c1">#Append to dictionary the cylinder properties</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Use default</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EgrModel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Submodels</span><span class="p">[</span><span class="s2">&quot;EgrModel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">reactants</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">mix</span><span class="p">)</span>
        
        <span class="c1">#NOTE: When introducing the injection models, need to compute EVO composition instead</span>
        
        <span class="c1">#Construct the EGR model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EgrModel</span> <span class="o">=</span> <span class="n">EgrModel</span><span class="o">.</span><span class="n">selector</span><span class="p">(</span><span class="n">egrModelType</span><span class="p">,</span> <span class="n">egrModelDict</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">EgrModel</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1">#Apply EGR to reactants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">mix</span><span class="o">.</span><span class="n">dilute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EgrModel</span><span class="o">.</span><span class="n">EgrMixture</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EgrModel</span><span class="o">.</span><span class="n">egr</span><span class="p">)</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel._constructCombustionModel">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._constructCombustionModel">[docs]</a>
    <span class="k">def</span> <span class="nf">_constructCombustionModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">combustionProperties</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the combustion model.</span>
<span class="sd">        Might be overwritten in child to set additional parameters to combustionModelDict </span>
<span class="sd">        (fuel for PremixedCombustion model is updated in SparkIgnitionEngine)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            combustionProperties (dict|Dictionary): the combustion properties</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            EngineModel: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Constructing combustion model&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;combustionProperties&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combustionProperties</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">):</span>
            <span class="n">combustionProperties</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="o">**</span><span class="n">combustionProperties</span><span class="p">)</span>
        
        <span class="n">combustionModelType</span> <span class="o">=</span> <span class="n">combustionProperties</span><span class="o">.</span><span class="n">lookupOrDefault</span><span class="p">(</span><span class="s2">&quot;CombustionModel&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fatal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">combustionModelType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#Get dictionary</span>
            <span class="n">combustionModelDict</span> <span class="o">=</span> <span class="n">combustionProperties</span><span class="o">.</span><span class="n">lookupOrDefault</span><span class="p">(</span><span class="n">combustionModelType</span> <span class="o">+</span> <span class="s2">&quot;Dict&quot;</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">())</span>
            <span class="n">combustionModelDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="c1">#Append reactants to combustion model dictionary</span>
                <span class="n">reactants</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">mix</span>    <span class="c1">#Initial in-cylinder mixture</span>
            <span class="p">)</span>
            
            <span class="c1">#Construct</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CombustionModel</span> <span class="o">=</span> <span class="n">CombustionModel</span><span class="o">.</span><span class="n">selector</span><span class="p">(</span><span class="n">combustionModelType</span><span class="p">,</span> <span class="n">combustionModelDict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Use default</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CombustionModel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Submodels</span><span class="p">[</span><span class="s2">&quot;CombustionModel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">reactants</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">mix</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">CombustionModel</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1">#Check consistency</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CombustionModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Types</span><span class="p">[</span><span class="s2">&quot;CombustionModel&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Combustion model type </span><span class="si">{</span><span class="n">combustionModelType</span><span class="si">}</span><span class="s2"> in combustionProperties dictionaries not compatible with allowed type for engine model </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Types</span><span class="p">[</span><span class="s1">&#39;CombustionModel&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>

        
    <span class="c1">#########################################################################</span>
    <span class="c1">#Updating methods:</span>
<div class="viewcode-block" id="EngineModel._updateMixtures">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._updateMixtures">[docs]</a>
    <span class="k">def</span> <span class="nf">_updateMixtures</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update mixture compositions (might be overwritten in child classes)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: Update the in-cylinder mixture based on injection models (may have already injected some mass)</span>
        
        <span class="c1">#Update the combustion model at current time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateCombustionModel</span><span class="p">()</span>
        
        <span class="c1">#Update in-cylinder mixture based on combustion model current mixture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CombustionModel</span><span class="o">.</span><span class="n">mixture</span><span class="p">)</span></div>

        
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel._updateCombustionModel">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._updateCombustionModel">[docs]</a>
    <span class="k">def</span> <span class="nf">_updateCombustionModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update combustion model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: Update the reactants mixture based on injection models (may have already injected some mass)</span>
        
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CombustionModel</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span> <span class="c1">#NOTE: update also fuel when implementing injection models</span></div>

    
    <span class="c1">#########################################################################</span>
    <span class="c1">#Dunder methods:</span>
<div class="viewcode-block" id="EngineModel.__str__">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">STR</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">STR</span> <span class="o">+=</span> <span class="s2">&quot;Engine model instance:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">STR</span> <span class="o">+=</span> <span class="s2">&quot;Engine time</span><span class="se">\n\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">STR</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">STR</span> <span class="o">+=</span> <span class="s2">&quot;Engine geometry:</span><span class="se">\n\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">STR</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">STR</span> <span class="o">+=</span> <span class="s2">&quot;EGR model:</span><span class="se">\n\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">EgrModel</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">STR</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">STR</span> <span class="o">+=</span> <span class="s2">&quot;Combustion model:</span><span class="se">\n\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CombustionModel</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">STR</span></div>

        
    <span class="c1">#########################################################################</span>
    <span class="c1">#Pre-processing methods:</span>
<div class="viewcode-block" id="EngineModel._loadFile">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._loadFile">[docs]</a>
    <span class="k">def</span> <span class="nf">_loadFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a file with raw data to self.raw. See EngineData.loadFile </span>
<span class="sd">        documentation for arguments:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">loadFile</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel._loadArray">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._loadArray">[docs]</a>
    <span class="k">def</span> <span class="nf">_loadArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">argv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads an array with raw data to self.raw. See EngineData.loadArray </span>
<span class="sd">        documentation for arguments:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span><span class="o">.</span><span class="n">loadArray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.loadData">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.loadData">[docs]</a>
    <span class="k">def</span> <span class="nf">loadData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataPath</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load raw data.</span>
<span class="sd">        </span>
<span class="sd">        TODO: Info</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            data (dict | Dictionary): Dictionary containing the data to load for each region.</span>
<span class="sd">            dataPath (str, optional): Global path where to load/write data. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            EngineModel: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading data&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data path: </span><span class="si">{</span><span class="n">dataPath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1">#Seth path info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;dataPath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataPath</span>
        
        <span class="c1">#Cast to Dictionary</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        
        <span class="c1">#Load data:</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="n">zoneDict</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
            
            <span class="c1">#Check that pressure is found (mandatory)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="n">zoneDict</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mandatory entry &#39;p&#39; in data dictionary for zone </span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2"> not found. Pressure trace must be loaded for each thermodynamic region.&quot;</span><span class="p">)</span>
            
            <span class="c1">#Loop over data to be loaded:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">zoneDict</span><span class="p">:</span>
                <span class="n">dataDict</span> <span class="o">=</span> <span class="n">zoneDict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">dataDict</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
                
                <span class="c1">#If the region is not cylinder, append its name to the field</span>
                <span class="n">entryName</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="n">entry</span> <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">zone</span> <span class="o">!=</span> <span class="s2">&quot;cylinder&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">currData</span><span class="p">:</span><span class="n">Dictionary</span> <span class="o">=</span> <span class="n">dataDict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
                <span class="n">opts</span><span class="p">:</span><span class="n">Dictionary</span> <span class="o">=</span> <span class="n">currData</span><span class="o">.</span><span class="n">lookupOrDefault</span><span class="p">(</span><span class="s2">&quot;opts&quot;</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">())</span>
                
                <span class="c1">#Get format</span>
                <span class="n">dataFormat</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="n">dataDict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dataFormat</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">):</span>
                    <span class="c1">#File</span>
                    <span class="n">fileName</span> <span class="o">=</span> <span class="n">currData</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;fileName&quot;</span><span class="p">)</span>
                    
                    <span class="c1">#relative to dataPath if given</span>
                    <span class="n">fileName</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataPath</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="k">if</span> <span class="n">dataPath</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">fileName</span>
                    
                    <span class="c1">#Load</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_loadFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">entryName</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="p">(</span><span class="n">dataFormat</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">):</span>
                    <span class="c1">#(CA,val) array</span>
                    <span class="n">dataArray</span> <span class="o">=</span> <span class="n">currData</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;array&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_loadArray</span><span class="p">(</span><span class="n">dataArray</span><span class="p">,</span> <span class="n">entryName</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
                
                <span class="k">elif</span> <span class="p">(</span><span class="n">dataFormat</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">):</span>
                    <span class="c1">#Function f(CA)</span>
                    <span class="n">function</span><span class="p">:</span><span class="n">FunctionType</span> <span class="o">=</span> <span class="n">currData</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;function&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s2">][function]&quot;</span><span class="p">)</span>
                    
                    <span class="n">CA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">CA</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">_loadArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">CA</span><span class="p">,</span><span class="n">f</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">entryName</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="p">(</span><span class="n">dataFormat</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">):</span>
                    <span class="c1">#Uniform value</span>
                    <span class="n">value</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="n">currData</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s2">][value]&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">[</span><span class="n">entryName</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                
                <span class="k">elif</span> <span class="p">(</span><span class="n">dataFormat</span> <span class="o">==</span> <span class="s2">&quot;calc&quot;</span><span class="p">):</span>
                    <span class="c1">#Apply operation between alredy loaded data</span>
                    <span class="n">function</span><span class="p">:</span><span class="n">FunctionType</span> <span class="o">=</span> <span class="n">currData</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;function&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s2">][function]&quot;</span><span class="p">)</span>
                    
                    <span class="c1">#Function arguments</span>
                    <span class="n">argNames</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span>
                    
                    <span class="c1">#Check if are present:</span>
                    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">argNames</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Field &#39;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&#39; was not loaded.&quot;</span><span class="p">)</span>
                    
                    <span class="c1">#Extract corresponding columns from data-frame:</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">argNames</span><span class="p">}</span>
                    
                    <span class="n">CA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">**</span><span class="n">cols</span><span class="p">)</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">_loadArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">CA</span><span class="p">,</span><span class="n">f</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">entryName</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown data format &#39;</span><span class="si">{</span><span class="n">dataFormat</span><span class="si">}</span><span class="s2">&#39; for entry </span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
                    
        <span class="k">return</span> <span class="bp">self</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.filterData">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.filterData">[docs]</a>
    <span class="k">def</span> <span class="nf">filterData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span><span class="s2">&quot;Filter|FunctionType|None&quot;</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        filter: Filter|FunctionType|None (optional)</span>
<span class="sd">            Filter to apply to raw data (e.g. resampling, low-pass filter, etc.). Required</span>
<span class="sd">            a method __call__(xp, yp)-&gt;(x,y) that resamples the dataset (xp,yp) to the</span>
<span class="sd">            datapoints (x,y).</span>
<span class="sd">        </span>
<span class="sd">        Filter the data in self.raw. Save the corresponding </span>
<span class="sd">        filtered data to self.data.</span>
<span class="sd">        If filter is None, data are cloned from self.raw</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#Save filter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span>
            
            <span class="c1">#Clone if no filter is given</span>
            <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loadArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span>
            
            <span class="c1">#Apply filter</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying filter </span><span class="si">{</span><span class="nb">filter</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span><span class="n">Filter</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nb">filter</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1">#Filter data</span>
                <span class="k">if</span> <span class="n">var</span> <span class="o">!=</span> <span class="s2">&quot;CA&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loadArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatalErrorInClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterData</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed filtering data&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.initializeThemodynamicModels">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.initializeThemodynamicModels">[docs]</a>
    <span class="k">def</span> <span class="nf">initializeThemodynamicModels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">initialConditions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the initial conditions of all thermodynamic regions of the EngineModel.</span>
<span class="sd">        For region to be initialized, a dict is given for the inital conditions,</span>
<span class="sd">        according to the following convention:</span>
<span class="sd">        </span>
<span class="sd">        -&gt;  If a float is given, the value is used</span>
<span class="sd">        -&gt;  If a str is given, it refers to the name of the vabiables stored in the EngineModel,</span>
<span class="sd">            in which case the corresponding initial condition is sampled from the the corresponding</span>
<span class="sd">            data-set at self.time.startTime.</span>
<span class="sd">        -&gt;  If string starting with @ is given, it applies that method with input (self.time.startTime)</span>

<span class="sd">        Ex:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;pressure&quot;: &quot;p&quot;,            #This interpolates self.data.p at self.time.startTime</span>
<span class="sd">            &quot;mass&quot;: 1.2e-3,             #Value</span>
<span class="sd">            &quot;volume&quot;: &quot;@geometry.V&quot;     #Evaluates self.geometry.V(self.time.startTime)</span>
<span class="sd">        }</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            **initialConditions:  data initialization of each zone in the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#Update start-time of engine time so that it is bounded to first avaliable time-step</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;CA&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data loaded yet.&quot;</span><span class="p">)</span>
            
            <span class="c1">#Set start-time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">updateStartTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">time</span>
            
            <span class="c1">#Update the mixtures at start-time (combustion models, injection models, etc.)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateMixtures</span><span class="p">()</span>
            
            <span class="n">initialConditions</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="o">**</span><span class="n">initialConditions</span><span class="p">)</span>
            <span class="c1">#Store initial conditions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;initialConditions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initialConditions</span>
            
            <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
                <span class="n">zoneDict</span> <span class="o">=</span> <span class="n">initialConditions</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">zoneDict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="s2">&quot;zoneDict&quot;</span><span class="p">)</span>
                
                <span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">zone</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">initializeState</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_preprocessThermoModelInput</span><span class="p">(</span><span class="n">zoneDict</span><span class="p">,</span> <span class="n">zone</span><span class="o">=</span><span class="n">zone</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatalErrorInClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterData</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed initializing thermodynamic regions&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel._preprocessThermoModelInput">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._preprocessThermoModelInput">[docs]</a>
    <span class="k">def</span> <span class="nf">_preprocessThermoModelInput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputDict</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">zone</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auxiliary function to pre-process input dictionary </span>
<span class="sd">        to initialization of a thermodynamic region</span>

<span class="sd">        NOTE:</span>
<span class="sd">            Might be overwritten in child class to also initialize </span>
<span class="sd">            the mixture composition, for example based on the combustion model.</span>
<span class="sd">            In such case, do so:</span>
<span class="sd">                def _preprocessThermoModelInput(self, inputDict:dict, zone:str) -&gt; dict:</span>
<span class="sd">                    tempDict = super()._preprocessThermoModelInput(inputDict, zone)</span>
<span class="sd">                    </span>
<span class="sd">                    ... #Manipulate mixture based on output dictionary</span>
<span class="sd">                    </span>
<span class="sd">                    nameList = [&quot;mass&quot;, &quot;temperature&quot;, &quot;pressure&quot;, &quot;volume&quot;, &quot;density&quot;]</span>
<span class="sd">                    outputDict = {v:[tempDict[v]] for v in tempDict if v in nameList}   #Set state variables</span>
<span class="sd">                    outputDict[&quot;mixture&quot;] = mix #Set mixture</span>
<span class="sd">                    </span>
<span class="sd">                    return outputDict</span>
<span class="sd">                    </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            inputDict (dict): dictionary for thermodynamic inputs</span>
<span class="sd">            zone (str): the zone name</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: processed dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO error handling</span>
        
        <span class="n">outputDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">inputDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
                <span class="c1">#Float -&gt; use value</span>
                <span class="n">outputDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="c1">#str</span>
                <span class="n">startTime</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">startTime</span>
                
                <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">):</span>
                    <span class="c1">#str with @ -&gt; apply method</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;outputDict[key] = self.</span><span class="si">{</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">(startTime)&quot;</span>
                    <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#str -&gt; interpolate</span>
                    <span class="n">outputDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="n">val</span> <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">zone</span> <span class="o">==</span> <span class="s2">&quot;cylinder&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)(</span><span class="n">startTime</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Error</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type &#39;</span><span class="si">{</span><span class="n">val</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; not supported (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">outputDict</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.preProcess">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.preProcess">[docs]</a>
    <span class="k">def</span> <span class="nf">preProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataPath</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="p">,</span> <span class="n">preProcessing</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initialConditions</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="n">Dictionary</span><span class="p">,</span> <span class="o">**</span><span class="n">junk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pre-processing:</span>
<span class="sd">            1) Loading data (from files or arrays)</span>
<span class="sd">            2) Pre-process the data (filtering, optional)</span>
<span class="sd">            3) Initialize thermodynamic regions</span>
<span class="sd">        </span>
<span class="sd">        NOTE:</span>
<span class="sd">        Naming of variables when loading data as follows:</span>
<span class="sd">            -&gt; By default they refer to the &quot;cylinder&quot; zone</span>
<span class="sd">            -&gt; Variables referred to a specific zone are allocated as &quot;&lt;variableName&gt;_&lt;zoneName&gt;&quot;</span>

<span class="sd">        TODO: example</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            data (dict | Dictionary): Dictionary with info for loading data.</span>
<span class="sd">            preProcessing (dict | Dictionary, optional): Dictionary with pre-processing information. Defaults to None.</span>
<span class="sd">            dataPath (str, optional): Master path of the tree. Defaults to None.</span>
<span class="sd">            initialConditions (dict | Dictionary): Dictionary with initial condition for thermodynamic models</span>

<span class="sd">        Returns:</span>
<span class="sd">            EngineModel: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#NOTE: **junk used to have other miscellaneous during contruction from dictionary.</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pre-processing&quot;</span><span class="p">)</span>
        
        <span class="c1">#Loading data:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="n">dataPath</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        
        <span class="c1"># Filtering data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;preProcessing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preProcessing</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">preProcessing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">preProcessing</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="o">**</span><span class="n">preProcessing</span><span class="p">)</span>
            <span class="n">filterType</span> <span class="o">=</span> <span class="n">preProcessing</span><span class="o">.</span><span class="n">lookupOrDefault</span><span class="p">(</span><span class="s2">&quot;Filter&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fatal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filterType</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1">#Got type name for run-time construction</span>
                <span class="nb">filter</span><span class="p">:</span><span class="n">Filter</span> <span class="o">=</span> <span class="n">Filter</span><span class="o">.</span><span class="n">selector</span><span class="p">(</span><span class="n">filterType</span><span class="p">,</span> <span class="n">preProcessing</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filterType</span><span class="si">}</span><span class="s2">Dict&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filterType</span><span class="p">,</span> <span class="n">Filter</span><span class="p">):</span>
                <span class="c1">#Got filter item</span>
                <span class="nb">filter</span> <span class="o">=</span> <span class="n">filterType</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#No filtering</span>
                <span class="k">pass</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">filterData</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
        
        <span class="c1">#Initial conditions for thermodinamic models:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeThemodynamicModels</span><span class="p">(</span><span class="o">**</span><span class="n">initialConditions</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span></div>

        
    <span class="c1">#########################################################################</span>
    <span class="c1">#Processing methods:</span>
<div class="viewcode-block" id="EngineModel.process">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.process">[docs]</a>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process the data, main time-loop.</span>
<span class="sd">        </span>
<span class="sd">        This is split into two function calls, which may be overwritten in child classes to tailored processings:</span>
<span class="sd">        1) _process__pre__: Create the columns in self.data for the fields generted by post-processing</span>
<span class="sd">        2) _update: The state-updating procedure in the main time-loop</span>
<span class="sd">        3) _process__post__: Final post-processing (e.g., computation of wall heat fluxes and rohr)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            EngineModel: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;startTime:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">startTime</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;endTime:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">endTime</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current time:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
            
            <span class="c1">#Create fields</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process__pre__</span><span class="p">()</span>
            
            <span class="c1">#Process cylinder data</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]):</span>
                <span class="c1">#Restart from last time</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

            <span class="c1">#Final updates (heat transfer, cumulatives, etc...)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process__post__</span><span class="p">()</span>
            
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatalErrorInClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed processing data for engine model </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel._process__pre__">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._process__pre__">[docs]</a>
    <span class="k">def</span> <span class="nf">_process__pre__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creation of the post-processed fields.</span>
<span class="sd">        </span>
<span class="sd">        NOTE:</span>
<span class="sd">            When overwriting, first call this method:</span>
<span class="sd">            def _process__pre__(self) -&gt; None:</span>
<span class="sd">                super()._process__pre__()</span>
<span class="sd">                ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Add fields to data:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dpdCA&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;AHRR&quot;</span><span class="p">,</span> <span class="s2">&quot;ROHR&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        
        <span class="c1">#Specie</span>
        <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">mix</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="c1">#Set initial values as start-time:</span>
        <span class="n">CA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">time</span>
        <span class="k">if</span> <span class="n">CA</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">startTime</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">CA</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            
            <span class="c1">#In-cylinder data</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">CA</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">CA</span><span class="p">)</span>
            <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">T</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">m</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;Tm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
            
            <span class="c1">#Ahrr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;ahrr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            
            <span class="c1">#Specie</span>
            <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">mix</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">specie</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specie</span><span class="o">.</span><span class="n">X</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">specie</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specie</span><span class="o">.</span><span class="n">Y</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel._update">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._update">[docs]</a>
    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for updating the state during the time-loop. Here updating </span>
<span class="sd">        cylinder as single-zone model without interaction with other regions.</span>
<span class="sd">        Could be overwritten for more detailed models (e.g., two-zone SI model, TJI, etc.)</span>
<span class="sd">        </span>
<span class="sd">        NOTE:</span>
<span class="sd">            When overwriting, afterwards call this method:</span>
<span class="sd">            def _update(self) -&gt; None:</span>
<span class="sd">                ...</span>
<span class="sd">                super()._update()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO injection models for mass end energy souce terms</span>
        <span class="c1">#TODO heat transfer models for temperature (open systems only!)</span>
        
        <span class="c1">#Current time</span>
        <span class="n">CA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">time</span>
        
        <span class="c1">#Update state</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">CA</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">CA</span><span class="p">)</span>
        <span class="n">dpdCA</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">CA</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">oldTime</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">deltaT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="n">V</span><span class="p">)</span>
        
        <span class="c1">#Gamma</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">T</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">m</span>
        
        <span class="c1">#Apparent heat release rate [J/CA]</span>
        <span class="c1">#Generalization to allow other EoS</span>
        <span class="n">TOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">oldTime</span><span class="p">)</span>
        <span class="n">pOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">oldTime</span><span class="p">)</span>
        <span class="n">mOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">oldTime</span><span class="p">)</span>
        <span class="c1">#Apporximating Us derivative backwards in time</span>
        <span class="n">dUsdCA</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">us</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">m</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">us</span><span class="p">(</span><span class="n">pOld</span><span class="p">,</span><span class="n">TOld</span><span class="p">)</span><span class="o">*</span><span class="n">mOld</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">deltaT</span>
        <span class="n">ahrr</span> <span class="o">=</span> <span class="n">dUsdCA</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dVdCA</span><span class="p">(</span><span class="n">CA</span><span class="p">)</span> <span class="c1">#- dmIndCA*mixtureIn.hs(p,T) + dmOutdCA*mixtureOut.hs(p,T)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateMixtures</span><span class="p">()</span>
        
        <span class="c1">#Store</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">CA</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1">#Main parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;dpdCA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpdCA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;AHRR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ahrr</span>
        
        <span class="c1">#Mixture composition</span>
        <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder</span><span class="o">.</span><span class="n">mixture</span><span class="o">.</span><span class="n">mix</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">specie</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">specie</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specie</span><span class="o">.</span><span class="n">X</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">specie</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specie</span><span class="o">.</span><span class="n">Y</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel._process__post__">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._process__post__">[docs]</a>
    <span class="k">def</span> <span class="nf">_process__post__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computing wall heat fluxes and rohr</span>
<span class="sd">        </span>
<span class="sd">        NOTE:</span>
<span class="sd">            When overwriting, first call this method:</span>
<span class="sd">            def _process__post__(self) -&gt; None:</span>
<span class="sd">                ...</span>
<span class="sd">                super()._process__post__()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#WHF and ROHR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_computeWallHeatFlux</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ROHR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;AHRR&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dQwalls&quot;</span><span class="p">]</span>
        
        <span class="c1">#Cumulatives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;cumHR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulativeIntegral</span><span class="p">(</span><span class="s2">&quot;ROHR&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;cumAHR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulativeIntegral</span><span class="p">(</span><span class="s2">&quot;AHRR&quot;</span><span class="p">)</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel._computeWallHeatFlux">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel._computeWallHeatFlux">[docs]</a>
    <span class="k">def</span> <span class="nf">_computeWallHeatFlux</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute wall heat fluxes for each patch and global value in each region. Might be overloaded in child.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">areas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">])</span>
        
        <span class="c1">#Compute wall heat transfer coefficient:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HeatTransferModel</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">CA</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;heatTransferCoeff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
        
        <span class="c1">#Total whf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dQwalls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Qwalls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;wallsArea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">areas</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;CA&quot;</span><span class="p">)]:</span>
            <span class="c1">#Search temperature as &quot;T&lt;patchName&gt;&quot;:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;T</span><span class="si">{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">Twall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;T</span><span class="si">{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="c1">#Fallback to default &quot;Twalls&quot;: </span>
            <span class="k">elif</span> <span class="s2">&quot;Twalls&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">Twall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Twalls&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute wall heat flux. Either load patch temperatures in the form t&lt;patchName&gt; or default temperature Twalls to compute wall heat fluxes.&quot;</span><span class="p">)</span>

            <span class="c1">#Compute patch area:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;wallsArea&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span>
            
            <span class="n">name</span> <span class="o">=</span> <span class="n">patch</span> <span class="o">+</span> <span class="s2">&quot;Area&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
            
            <span class="c1">#Compute wall heat flux at patch [converted to J/CA]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;dQ</span><span class="si">{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Twall</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dCAdt</span>
            
            <span class="c1">#Compute cumulative</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulativeIntegral</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dQ</span><span class="si">{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1">#Add to total</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dQwalls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;dQ</span><span class="si">{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Qwalls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span></div>

            
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.refresh">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.refresh">[docs]</a>
    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reset</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh data and restart processing:</span>
<span class="sd">            1) loadData</span>
<span class="sd">            2) filterData</span>
<span class="sd">            3) process</span>

<span class="sd">        Args:</span>
<span class="sd">            reset (bool, optional): If need to restart from scratch. Defaults to False.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            EngineModel: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: refactoring of initialization of thermodynamic models</span>
        <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">EngineData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="n">EngineData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preProcess</span><span class="p">(</span>
                <span class="n">dataPath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;dataPath&quot;</span><span class="p">],</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
                <span class="n">preProcessing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;preProcessing&quot;</span><span class="p">],</span>
                <span class="n">initialConditions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;initialConditions&quot;</span><span class="p">])</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;dataPath&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">])</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">()</span></div>

        
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.integrateVariable">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.integrateVariable">[docs]</a>
    <span class="k">def</span> <span class="nf">integrateVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;CA&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integrate a variable over another. </span>
<span class="sd">        If inital or final CA are not given, are set to first/last in CA range.</span>

<span class="sd">        Args:</span>
<span class="sd">            y (str): name of y variable.</span>
<span class="sd">            x (str, optional): Name of x variable. Defaults to &quot;CA&quot;.</span>
<span class="sd">            start (float, optional): Initial CA. Defaults to None.</span>
<span class="sd">            end (float, optional): Final CA. Defaults to None.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            float: Integrated value </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable &#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#39; not present among data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable &#39;</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&#39; not present among data.&quot;</span><span class="p">)</span>
        
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
        
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">end</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">end</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
        
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        
        <span class="c1">#Filter out &quot;nan&quot;</span>
        <span class="n">Yarray</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">Yarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Yarray</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Yarray</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">])</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.cumulativeIntegral">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.cumulativeIntegral">[docs]</a>
    <span class="k">def</span> <span class="nf">cumulativeIntegral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;CA&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the cumulative integral of a variable over another. </span>
<span class="sd">        If start is not given, it is set to self.time.startOfCombustion.</span>

<span class="sd">        Args:</span>
<span class="sd">            y (str): name of y variable.</span>
<span class="sd">            x (str, optional): Name of x variable. Defaults to &quot;CA&quot;.</span>
<span class="sd">            start (float, optional): Initial CA. Defaults to None.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Cumulative integral function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable &#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#39; not present among data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable &#39;</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&#39; not present among data.&quot;</span><span class="p">)</span>
        
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
        
        <span class="c1">#Check for start</span>
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">startOfCombustion</span><span class="p">()</span> <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start</span>
        <span class="c1">#Check for motored</span>
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start</span>
        <span class="c1">#Check type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
        
        <span class="c1">#Filter out &quot;nan&quot;</span>
        <span class="n">Yarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">Yarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Yarray</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="c1">#Compute cumulative</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">cumulative_trapezoid</span><span class="p">(</span><span class="n">Yarray</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="c1">#Set zero at start</span>
        <span class="n">valAtStart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">],</span> <span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">-=</span> <span class="n">valAtStart</span>
        
        <span class="k">return</span> <span class="n">out</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.IMEP">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.IMEP">[docs]</a>
    <span class="k">def</span> <span class="nf">IMEP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute indicated mean effective pressure. </span>
<span class="sd">        If inital or final CA are not given, are set to first/last in CA range.</span>

<span class="sd">        Args:</span>
<span class="sd">            start (float, optional): Initial CA. Defaults to None.</span>
<span class="sd">            end (float, optional): Final CA. Defaults to None.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            float: IMEP [Pa]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">end</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">end</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
        
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">work</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]))</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.work">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.work">[docs]</a>
    <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute indicated work (positive outgoing). </span>
<span class="sd">        If inital or final CA are not given, are set to first/last in CA range.</span>

<span class="sd">        Args:</span>
<span class="sd">            start (float, optional): Initial CA. Defaults to None.</span>
<span class="sd">            end (float, optional): Final CA. Defaults to None.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            float: Work [J]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
        
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">end</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">end</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
        
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">])</span></div>

    
    <span class="c1">####################################</span>
<div class="viewcode-block" id="EngineModel.plotPV">
<a class="viewcode-back" href="../../../../../autoapi/libICEpost/src/engineModel/EngineModel/EngineModel/index.html#libICEpost.src.engineModel.EngineModel.EngineModel.EngineModel.plotPV">[docs]</a>
    <span class="k">def</span> <span class="nf">plotPV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">start</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loglog</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timingsParams</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the pressure-volume diagram of the thermodynamic cycle.</span>

<span class="sd">        Args:</span>
<span class="sd">            start (float, optional): The beginning of the plot (CA). Defaults to None.</span>
<span class="sd">            end (float, optional): The end of the plot (CA). Defaults to None.</span>
<span class="sd">            loglog (bool, optional): log-log scale. Defaults to True.</span>
<span class="sd">            timingsParams(dict, optional): The kwargs for the scatter for timings. Defaults to:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;edgecolor&quot;:&quot;k&quot;,</span>
<span class="sd">                &quot;zorder&quot;:2,</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Get start and end</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span>
        
        <span class="c1">#Set default timingsParams</span>
        <span class="n">default</span> <span class="o">=</span> \
        <span class="p">{</span>
            <span class="s2">&quot;edgecolor&quot;</span><span class="p">:</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="s2">&quot;zorder&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">timingsParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">p</span><span class="p">:</span><span class="n">default</span><span class="p">[</span><span class="n">p</span><span class="p">]})</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">default</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">timingsParams</span><span class="p">]</span>
        
        <span class="c1">#Check arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">end</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkType</span><span class="p">(</span><span class="n">loglog</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="s2">&quot;loglog&quot;</span><span class="p">)</span>
        
        <span class="c1">#Check if data were already processed:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data were not yet loaded/pre-processed (field p not present in self.data).&quot;</span><span class="p">)</span>
        
        <span class="c1">#Compute volume</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">])</span>
        
        <span class="c1">#Compute pressure in bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;pBar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e5</span>
        
        <span class="c1">#Plot</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;pBar&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;V [$m^3$]&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;p [bar]&quot;</span><span class="p">,</span> <span class="n">loglog</span><span class="o">=</span><span class="n">loglog</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1">#Timings</span>
        <span class="n">timings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">timings</span>
        <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="n">timingsParams</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;markersize&quot;</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">timings</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;markersize&quot;</span> <span class="ow">in</span> <span class="n">timingsParams</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1">#The size of the markers</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;facecolor&quot;</span> <span class="ow">in</span> <span class="n">timingsParams</span><span class="p">:</span> <span class="c1">#Use same color of plot if not specified</span>
            <span class="n">timingsParams</span><span class="p">[</span><span class="s2">&quot;facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span> <span class="n">get_color</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">timings</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">timings</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">pBar</span><span class="p">(</span><span class="n">timings</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">timings</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">timingsParams</span><span class="p">)</span>
        
        <span class="c1">#Return the Axes</span>
        <span class="k">return</span> <span class="n">ax</span></div>
</div>

    
<span class="c1">#########################################################################</span>
<span class="c1">#Create selection table</span>
<span class="n">EngineModel</span><span class="o">.</span><span class="n">createRuntimeSelectionTable</span><span class="p">()</span>
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, libICEpost.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>